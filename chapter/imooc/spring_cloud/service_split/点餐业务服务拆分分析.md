# 点餐业务服务拆分分析

点餐分为卖家端和买家端；可以分为

1. 模块划分
  * 手机端
  * pc端

  两端都往后面通用服务请求
2. 按业务划分
  * 订单
  * 商品
  * 支付

## 扩展立方模型（scale cube）

![](/assets/image/imooc/spring_cloud/snipaste_20180815_235118.png)

* x轴 水平复制 ： 通过副本扩展
* z轴 数据分区 ： 每个服务器负责一个数据子集
* y轴 功能解耦 ： 将不同职责的模块分解成不同的服务

两个关键的点：功能和数据

## 如何拆 功能

* 单一职责，松耦合，高内聚

  松耦合：修改一个服务只需要单点修改，而不是牵一发动全身

  高内聚：相关的行为都聚集在一个服务中
* 关注点分离

  领域驱动设计；
  - 按职责 ：按业务领域划分出来的服务，订单，商品，app接口，等划分为边缘服务
  - 按通用性 ：通用性，与具体业务无关的，如消息服务，用户服务
  - 按粒度级别 ：不太好把握的点。

* 服务和数据的关系
  - 线考虑业务功能，再考虑数据
  - 无状态服务：

    如果一个数据需要被多个服务共享才能完成一个请求，这个数据叫状态，依赖这个数据的服务叫有状态服务。

    要把有状态的业务服务改造成无状态服务

## 点餐业务服务拆分
![](/assets/image/imooc/spring_cloud/snipaste_20180816_000609.png)

左边是现有应用的组成：
1. 中间的是一个整体应用提供rest服务
2. 边缘是不同的应用端

右边的是当前设计的：

* 订单 和 商品 单独拆分出来成独立的微服务；

  既能为 在ngix上的app vue提供服务，又能为 卖家端webui提供服务
* 支付和原始ui实现在一个微服务中：由于支付的特点，包含支付
* 用户独立出来
* 广告独立出来
* app vue 单独打包放在nginx上

微服务不能一直设计，要根据当前的业务需求进行拆分，快速上线，要用于面对失败；

在点餐业务中，快速的选定1到2个业务，确定他的场景和要达到的效果；快速开发，快速试错，不要想一次性分好；

这里选择 订单和商品服务，他们之间有调用关系，有应用间的通信知识点
